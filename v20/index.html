<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Motorcycle Ride Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: monospace;
      background-color: #000;
      color: #0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      border-radius: 8px;
    }
    button:hover {
      background: #0f0;
      color: #000;
    }
    #rideModal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      color: #fff;
      z-index: 9999;
      padding: 20px;
      overflow: auto;
    }
    #pdfContent {
      background: #111;
      padding: 20px;
      border-radius: 10px;
    }
    h2, h3, p, ul, li, pre {
      margin: 8px 0;
    }
  </style>
</head>
<body>

  <h1>üèçÔ∏è Ride Tracker</h1>
  <button onclick="startLog()">‚ñ∂ Start Ride</button>
  <button onclick="stopLog()">‚èπ Stop Ride</button>
  <button onclick="showRideReport()">üìä Show Report</button>

  <div id="rideModal">
    <div id="pdfContent"></div>
    <div style="margin-top:20px;">
      <button onclick="downloadPDF()">üìÑ Download PDF</button>
      <button onclick="shareReport()">üì§ Share</button>
      <button onclick="closeModal()">‚ùå Close</button>
    </div>
  </div>
  <script>
  let log = [];
  let logging = false;
  let intervalId;
  let speedZones = { zone1: 0, zone2: 0, zone3: 0, zone4: 0 };
  let rideStartTime, rideEndTime;

  function startLog() {
    log = [];
    logging = true;
    speedZones = { zone1: 0, zone2: 0, zone3: 0, zone4: 0 };
    rideStartTime = new Date();

    intervalId = setInterval(() => {
      const timestamp = new Date().toISOString();
      const lat = (9.96 + Math.random() * 0.02).toFixed(5);
      const speed = +(Math.random() * 100).toFixed(1);
      const grip = ['Good', 'Medium', 'Low'][Math.floor(Math.random() * 3)];
      const distance = +(Math.random() * 0.5).toFixed(2);
      const lean = +(Math.random() * 45).toFixed(1);
      log.push(`${timestamp},${lat},${speed},${grip},${distance},${lean}`);

      if (speed <= 25) speedZones.zone1++;
      else if (speed <= 40) speedZones.zone2++;
      else if (speed <= 60) speedZones.zone3++;
      else speedZones.zone4++;
    }, 1000);
  }

  function stopLog() {
    if (intervalId) clearInterval(intervalId);
    rideEndTime = new Date();
    logging = false;
  }

  function showRideReport() {
    if (log.length === 0) {
      alert("No ride data available.");
      return;
    }

    let totalDistance = 0;
    let totalSpeed = 0;
    log.forEach(entry => {
      const parts = entry.split(',');
      const speed = parseFloat(parts[2]);
      const distance = parseFloat(parts[4]);
      totalSpeed += speed;
      totalDistance += distance;
    });

    const avgSpeed = (totalSpeed / log.length).toFixed(2);
    const rideDuration = ((rideEndTime - rideStartTime) / 1000).toFixed(0);
    const zoneTotal = speedZones.zone1 + speedZones.zone2 + speedZones.zone3 + speedZones.zone4;
    const percent = z => (zoneTotal ? (z / zoneTotal * 100).toFixed(1) : 0);

    const reportHTML = `
      <h2>Ride Report</h2>
      <p><strong>Start Time:</strong> ${rideStartTime.toLocaleString()}</p>
      <p><strong>End Time:</strong> ${rideEndTime.toLocaleString()}</p>
      <p><strong>Duration:</strong> ${rideDuration} seconds</p>
      <p><strong>Total Distance:</strong> ${totalDistance.toFixed(2)} km</p>
      <p><strong>Average Speed:</strong> ${avgSpeed} km/h</p>
      <h3>Speed Zone Distribution</h3>
      <ul>
        <li>0‚Äì25 km/h: ${percent(speedZones.zone1)}%</li>
        <li>25‚Äì40 km/h: ${percent(speedZones.zone2)}%</li>
        <li>40‚Äì60 km/h: ${percent(speedZones.zone3)}%</li>
        <li>60+ km/h: ${percent(speedZones.zone4)}%</li>
      </ul>
      <h3>Raw Log</h3>
      <pre>${log.join('\n')}</pre>
    `;

    document.getElementById("pdfContent").innerHTML = reportHTML;
    document.getElementById("rideModal").style.display = "flex";
  }

  function downloadPDF() {
    const element = document.getElementById("pdfContent");
    html2pdf().from(element).save("ride-report.pdf");
  }

  function shareReport() {
    const text = log.join('\n');
    const blob = new Blob([text], { type: 'text/plain' });
    const file = new File([blob], "ride-report.txt", { type: 'text/plain' });

    if (navigator.share) {
      navigator.share({
        title: 'Ride Report',
        text: 'Here is my motorcycle ride report.',
        files: [file]
      }).catch(err => console.log("Share failed:", err));
    } else {
      alert("Share not supported on this device.");
    }
  }

  function closeModal() {
    document.getElementById("rideModal").style.display = "none";
  }
</script>

</body>
</html>
