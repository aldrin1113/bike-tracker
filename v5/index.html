<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Motorcycle Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 20px;
    }

    .dashboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      width: 100%;
    }

    .info-box {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      margin: 10px;
      flex: 1 1 300px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .info {
      margin: 10px 0;
    }

    .speed-bar {
      height: 120px;
      width: 30px;
      background: #444;
      border-radius: 5px;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
    }

    .speed-fill {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: lime;
      transition: height 0.2s ease;
    }

    .lean-gauge {
      width: 160px;
      height: 80px;
      margin: 0 auto;
    }

    .lean-gauge path {
      stroke-width: 8;
    }

    .lean-gauge line {
      stroke-width: 6;
      stroke-linecap: round;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>üèçÔ∏è Motorcycle Tracker</h1>

  <div class="dashboard">
    <div class="info-box">
      <div class="info">Speed</div>
      <div class="speed-bar">
        <div id="speedBar" class="speed-fill"></div>
      </div>
      <div class="info"><strong id="speedDisplay">0</strong> km/h</div>
    </div>

    <div class="info-box">
      <div class="info">Lean Angle</div>
      <svg class="lean-gauge" viewBox="0 0 100 50">
        <path d="M10 50 A40 40 0 0 1 90 50" fill="none" stroke="#888" />
        <line id="leanNeedle" x1="50" y1="50" x2="50" y2="10" stroke="red" />
      </svg>
      <div class="info">Lean: <strong id="leanDisplay">0</strong>¬∞</div>
      <div class="info">Grip: <strong id="gripDisplay">Good</strong></div>
    </div>
  </div>

  <div class="buttons">
    <button onclick="calibrateLean()">Calibrate</button>
    <button onclick="startLog()">Start Log</button>
    <button onclick="stopLog()">Stop Log</button>
    <button onclick="clearLog()">Clear Log</button>
    <button onclick="downloadLog()">Download Log</button>
  </div>

  <script>
    let lean = 0;
    let speed = 0;
    let smoothedSpeed = 0;
    let logData = [];
    let isLogging = false;
    let logInterval;
    const smoothingFactor = 0.05; // lower sensitivity

    function calibrateLean() {
      window.calibration = lean;
    }

    function startLog() {
      isLogging = true;
      logInterval = setInterval(() => {
        if (isLogging) {
          logData.push(`${Date.now()},${Math.round(smoothedSpeed)} km/h,${lean >= 0 ? 'Right' : 'Left'} ${Math.abs(lean).toFixed(1)}¬∞,${document.getElementById("gripDisplay").textContent}`);
        }
      }, 3000);
    }

    function stopLog() {
      isLogging = false;
      clearInterval(logInterval);
    }

    function clearLog() {
      logData = [];
    }

    function downloadLog() {
      const blob = new Blob([logData.join("\n")], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ride_log.csv";
      a.click();
    }

    function updateLeanNeedle(angle) {
      const maxAngle = 60;
      const clamped = Math.max(-maxAngle, Math.min(maxAngle, angle));
      const radians = (clamped / maxAngle) * (Math.PI / 2);
      const length = 35;
      const x2 = 50 + length * Math.sin(radians);
      const y2 = 50 - length * Math.cos(radians);
      document.getElementById("leanNeedle").setAttribute("x2", x2);
      document.getElementById("leanNeedle").setAttribute("y2", y2);
    }

    function updateDisplay() {
      document.getElementById("speedDisplay").textContent = Math.round(smoothedSpeed);
      document.getElementById("leanDisplay").textContent = Math.abs(lean).toFixed(1);
      document.getElementById("gripDisplay").textContent =
        Math.abs(lean) > 50 ? "Low" : smoothedSpeed > 70 ? "Medium" : "Good";
      document.getElementById("speedBar").style.height = Math.min(smoothedSpeed, 120) + "%";
      updateLeanNeedle(lean);
    }

    if (window.DeviceMotionEvent) {
      window.addEventListener("devicemotion", (event) => {
        const x = event.accelerationIncludingGravity.x;
        const y = event.accelerationIncludingGravity.y;
        lean = Math.atan2(x, y) * (180 / Math.PI);
      });
    }

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition((position) => {
        speed = (position.coords.speed || 0) * 3.6;
        smoothedSpeed = smoothedSpeed * (1 - smoothingFactor) + speed * smoothingFactor;
        updateDisplay();
      });
    }
  </script>
</body>
</html>
